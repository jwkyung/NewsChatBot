# 검색 기록 문제 해결 가이드

## 🔍 문제 진단

검색 기록이 표시되지 않는 원인을 확인하기 위해 다음을 점검하세요:

### 1. 브라우저 콘솔 확인

1. **F12 키 누르기** (개발자 도구)
2. **Console 탭 확인**
3. **다음 메시지 확인:**
   - "검색 기록 조회: X개 발견" → 정상 작동
   - "DB 저장 오류" → 데이터베이스 저장 실패
   - "검색 기록 조회 오류" → API 오류

### 2. 네트워크 탭 확인

1. **F12 → Network 탭**
2. **"검색 기록" 버튼 클릭**
3. **`/api/searches` 요청 확인:**
   - 상태 코드가 200인지 확인
   - 응답 데이터 확인

---

## 🔧 가능한 원인 및 해결

### 원인 1: 데이터베이스에 저장되지 않음

**증상:**
- 뉴스 검색은 성공
- 검색 기록이 비어있음

**확인 방법:**
1. 브라우저 콘솔에서 "DB 저장 오류" 메시지 확인
2. Vercel 배포 로그 확인

**해결 방법:**
1. **환경변수 확인:**
   - Vercel Settings → Environment Variables
   - `POSTGRES_PRISMA_URL` 확인

2. **데이터베이스 연결 확인:**
   - Prisma Cloud에서 데이터베이스 상태 확인
   - 연결 문자열이 올바른지 확인

3. **Vercel 배포 로그 확인:**
   - Deployments → 최신 배포 → Logs
   - "DB 저장 오류" 메시지 확인

---

### 원인 2: API 요청 실패

**증상:**
- "검색 기록" 버튼 클릭 시 아무 반응 없음
- 또는 오류 메시지 표시

**확인 방법:**
1. 브라우저 콘솔 확인 (F12)
2. Network 탭에서 `/api/searches` 요청 확인

**해결 방법:**
1. **API 엔드포인트 확인:**
   - `/api/searches` 경로가 올바른지 확인
   - Vercel Functions 로그 확인

2. **CORS 오류 확인:**
   - 브라우저 콘솔에서 CORS 관련 오류 확인

---

### 원인 3: 데이터베이스 테이블이 생성되지 않음

**증상:**
- 첫 배포 후 검색 기록이 작동하지 않음

**해결 방법:**
1. **Prisma 마이그레이션 확인:**
   - Vercel 배포 로그에서 Prisma generate 확인
   - 데이터베이스 테이블이 생성되었는지 확인

2. **Prisma Studio로 확인:**
   - 로컬에서 `npm run db:studio` 실행
   - 데이터베이스에 데이터가 있는지 확인

---

## ✅ 수정된 내용

다음 개선사항이 적용되었습니다:

1. **검색 기록이 없을 때 안내 메시지 표시**
2. **오류 발생 시 사용자에게 알림**
3. **상세한 로그 출력 (디버깅용)**

---

## 🧪 테스트 방법

### 1. 뉴스 검색 후 저장 확인

1. 키워드로 뉴스 검색
2. 브라우저 콘솔 확인 (F12)
3. "검색 기록 저장 성공" 메시지 확인

### 2. 검색 기록 불러오기

1. "검색 기록" 버튼 클릭
2. 브라우저 콘솔 확인
3. "검색 기록 조회: X개 발견" 메시지 확인

### 3. 검색 기록이 없을 때

1. 첫 검색 전에 "검색 기록" 버튼 클릭
2. "저장된 검색 기록이 없습니다" 메시지 확인

---

## 📋 체크리스트

문제 해결을 위한 확인 사항:

- [ ] `POSTGRES_PRISMA_URL` 환경변수 확인
- [ ] 브라우저 콘솔 오류 확인
- [ ] Network 탭에서 API 요청 확인
- [ ] Vercel 배포 로그 확인
- [ ] 데이터베이스 연결 상태 확인

---

## 🔄 다음 단계

1. **수정된 코드를 GitHub에 푸시**
2. **Vercel 자동 재배포 확인**
3. **배포 완료 후 다시 테스트**

문제가 계속되면:
- 브라우저 콘솔의 오류 메시지
- Vercel 배포 로그의 오류 메시지
- Network 탭의 API 응답

이 정보들을 알려주시면 더 정확히 도와드릴 수 있습니다.
