# 500 에러 해결 가이드

## 🔍 발견된 에러

브라우저 콘솔에서 확인된 에러:
1. ❌ `/favicon.ico` - 404 에러 (무시해도 됨, 파비콘 없음)
2. ❌ `/api/searches?limit=10` - **500 에러** (핵심 문제!)
3. ❌ `/api/searches?limit=10` - **500 에러** (중복 요청)

---

## 🎯 핵심 문제

`/api/searches` 엔드포인트에서 500 에러가 발생하고 있습니다.
이는 검색 기록을 불러올 때 서버 오류가 발생한다는 의미입니다.

---

## 🔧 가능한 원인 및 해결

### 원인 1: 데이터베이스 연결 실패

**확인 방법:**
1. Vercel 배포 로그 확인
2. Functions 로그 확인

**해결 방법:**
1. **환경변수 확인:**
   - Vercel Settings → Environment Variables
   - `POSTGRES_PRISMA_URL` 확인
   - 값이 올바른지 확인

2. **Prisma Cloud 확인:**
   - 데이터베이스가 활성화되어 있는지 확인
   - 연결 문자열이 유효한지 확인

---

### 원인 2: Prisma 클라이언트가 생성되지 않음

**확인 방법:**
- Vercel 배포 로그에서 "Prisma Client has not been generated" 확인

**해결 방법:**
1. **package.json 확인:**
   ```json
   {
     "scripts": {
       "postinstall": "prisma generate",
       "build": "prisma generate && next build"
     }
   }
   ```

2. **재배포:**
   - GitHub에 푸시하여 자동 재배포
   - 또는 Vercel에서 수동 재배포

---

### 원인 3: 데이터베이스 테이블이 생성되지 않음

**확인 방법:**
- Prisma Cloud에서 테이블 확인
- 또는 Vercel 배포 로그 확인

**해결 방법:**
1. **Prisma 마이그레이션 실행:**
   - 로컬에서: `npm run db:push`
   - Vercel에서는 자동으로 실행되어야 함

2. **Prisma Studio로 확인:**
   - 로컬에서: `npm run db:studio`
   - 데이터베이스에 테이블이 있는지 확인

---

### 원인 4: 환경변수 이름 불일치

**확인:**
- `prisma/schema.prisma`에서 사용하는 환경변수 이름
- Vercel에 설정된 환경변수 이름

**해결:**
- `prisma/schema.prisma` 확인:
  ```prisma
  datasource db {
    provider = "postgresql"
    url      = env("POSTGRES_PRISMA_URL")
  }
  ```
- Vercel에 `POSTGRES_PRISMA_URL`이 있는지 확인

---

## 📋 단계별 해결 방법

### 1단계: Vercel 배포 로그 확인

1. **Vercel 대시보드 → Deployments**
2. **최신 배포 클릭**
3. **Functions 탭 또는 Logs 탭 확인**
4. **오류 메시지 확인:**
   - "Prisma Client has not been generated"
   - "Database connection failed"
   - "Environment variable not found"

---

### 2단계: 환경변수 재확인

1. **Vercel Settings → Environment Variables**
2. **다음 확인:**
   - ✅ `GEMINI_API_KEY` - 있음
   - ✅ `POSTGRES_PRISMA_URL` - 있음, 값 확인

3. **환경변수 값 확인:**
   - `POSTGRES_PRISMA_URL` 클릭하여 값 확인
   - Prisma ORM.txt 파일의 값과 일치하는지 확인

---

### 3단계: Prisma Cloud 확인

1. **Prisma Cloud 대시보드 접속**
2. **데이터베이스 상태 확인:**
   - 데이터베이스가 활성화되어 있는지
   - 연결이 정상인지

3. **연결 문자열 확인:**
   - Prisma ORM.txt 파일의 값과 일치하는지

---

### 4단계: 코드 수정 후 재배포

수정된 코드가 GitHub에 푸시되었는지 확인:

1. **GitHub 저장소 확인:**
   - https://github.com/jwkyung/NewsChatBot
   - 최신 코드가 업로드되었는지 확인

2. **Vercel 자동 재배포 확인:**
   - GitHub 푸시 후 자동으로 재배포됨
   - 배포 완료까지 대기 (2-5분)

---

## 🧪 테스트 방법

### 배포 후 테스트:

1. **브라우저 콘솔 확인 (F12)**
2. **"검색 기록" 버튼 클릭**
3. **콘솔 메시지 확인:**
   - ✅ "검색 기록 조회 성공: X개 발견" → 정상
   - ❌ "검색 기록 조회 오류" → 문제 지속

---

## ✅ 체크리스트

- [ ] Vercel 배포 로그 확인
- [ ] `POSTGRES_PRISMA_URL` 환경변수 확인
- [ ] Prisma Cloud 데이터베이스 상태 확인
- [ ] GitHub에 최신 코드 푸시 확인
- [ ] Vercel 재배포 완료 확인
- [ ] 브라우저 콘솔에서 오류 확인

---

## 📞 다음 단계

1. **Vercel 배포 로그 확인** (가장 중요!)
2. **로그의 구체적인 오류 메시지 확인**
3. **오류 메시지를 알려주시면 더 정확한 해결책 제공**

Vercel 배포 로그에서 어떤 오류 메시지가 나오는지 알려주세요!
