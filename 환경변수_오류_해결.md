# 환경변수 오류 해결 가이드

## 🔍 발견된 핵심 오류

```
PrismaClientInitializationError: 
Environment variable not found: POSTGRES_PRISMA_URL
```

**문제:** 빌드 시점에 `POSTGRES_PRISMA_URL` 환경변수를 찾을 수 없습니다.

---

## 🎯 해결 방법

### 방법 1: Vercel 환경변수 확인 및 재설정 (가장 중요!)

#### 1단계: 환경변수 확인

1. **Vercel 대시보드 접속**
2. **프로젝트 선택: `news-chat-bot`**
3. **Settings → Environment Variables**
4. **`POSTGRES_PRISMA_URL` 확인:**
   - ✅ 변수가 있는지 확인
   - ✅ 값이 올바른지 확인
   - ✅ Prisma ORM.txt 파일의 2번째 줄과 일치하는지 확인

#### 2단계: 환경변수 재설정 (필요 시)

**환경변수가 없거나 잘못된 경우:**

1. **"Add Environment Variable" 클릭**
2. **Key 입력:**
   ```
   POSTGRES_PRISMA_URL
   ```
3. **Value 입력:**
   - Prisma ORM.txt 파일의 2번째 줄 전체 복사:
   ```
   prisma+postgres://accelerate.prisma-data.net/?api_key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```
4. **Environments 선택:**
   - ✅ Production
   - ✅ Preview
   - ✅ Development
   (모두 선택)
5. **Save 클릭**

#### 3단계: 재배포

1. **Deployments → 최신 배포**
2. **"Redeploy" 버튼 클릭**
3. **또는 GitHub에 푸시하여 자동 재배포**

---

### 방법 2: Prisma 스키마 확인

`prisma/schema.prisma` 파일 확인:

```prisma
datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}
```

**확인 사항:**
- ✅ `provider = "postgresql"` - PostgreSQL 사용
- ✅ `url = env("POSTGRES_PRISMA_URL")` - 올바른 환경변수 이름

---

### 방법 3: 빌드 시 환경변수 사용 확인

Vercel에서는 빌드 시점에도 환경변수가 필요합니다.

**확인:**
1. **Vercel Settings → Environment Variables**
2. **각 환경변수의 "Environments" 확인:**
   - Production ✅
   - Preview ✅
   - Development ✅
   (모두 선택되어 있어야 함)

---

## 📋 단계별 해결 체크리스트

### 1단계: 환경변수 확인
- [ ] Vercel Settings → Environment Variables 접속
- [ ] `POSTGRES_PRISMA_URL` 변수가 있는지 확인
- [ ] 값이 Prisma ORM.txt와 일치하는지 확인

### 2단계: 환경변수 재설정 (필요 시)
- [ ] 환경변수가 없으면 추가
- [ ] 값이 잘못되었으면 수정
- [ ] 모든 환경(Production, Preview, Development) 선택
- [ ] Save 클릭

### 3단계: 재배포
- [ ] Deployments → Redeploy 클릭
- [ ] 또는 GitHub에 푸시하여 자동 재배포
- [ ] 배포 완료 대기

### 4단계: 빌드 로그 확인
- [ ] Deployments → 최신 배포 → Build Logs
- [ ] "Prisma generate" 성공 확인
- [ ] 환경변수 오류가 사라졌는지 확인

---

## ⚠️ 주의사항

### 환경변수 값 형식

**올바른 형식:**
```
prisma+postgres://accelerate.prisma-data.net/?api_key=...
```

**잘못된 형식:**
- ❌ 따옴표 포함: `"prisma+postgres://..."`
- ❌ 공백 포함: `prisma+postgres://... ` (끝에 공백)
- ❌ 줄바꿈 포함

### 환경변수 설정 위치

**중요:** Vercel에서 환경변수를 설정할 때:
- **Team Level**: 모든 프로젝트에서 사용 가능
- **Project Level**: 특정 프로젝트에서만 사용 가능

**확인:** 환경변수가 올바른 프로젝트에 설정되었는지 확인

---

## 🔧 추가 문제 해결

### 문제: 환경변수를 설정했는데도 오류가 발생

**해결:**
1. **환경변수 이름 확인:**
   - 정확히 `POSTGRES_PRISMA_URL` (대소문자 구분)
   - 오타 없이 입력

2. **재배포:**
   - 환경변수를 추가/수정한 후에는 반드시 재배포 필요
   - 자동 재배포가 안 되면 수동으로 Redeploy

3. **빌드 로그 확인:**
   - Deployments → Build Logs
   - 환경변수가 빌드 시점에 사용 가능한지 확인

---

## ✅ 성공 확인

재배포 후 다음을 확인:

1. **빌드 로그:**
   - "Prisma generate" 성공
   - "Environment variable not found" 오류 없음

2. **런타임 로그:**
   - "Prisma 연결 실패" 오류 없음
   - 검색 기록 기능 정상 작동

---

## 📞 다음 단계

1. **Vercel에서 `POSTGRES_PRISMA_URL` 환경변수 확인**
2. **Prisma ORM.txt 값과 일치하는지 확인**
3. **재배포 후 테스트**

문제가 계속되면:
- 환경변수 설정 스크린샷
- 빌드 로그의 구체적인 오류 메시지

이 정보들을 알려주시면 더 정확히 도와드릴 수 있습니다.
